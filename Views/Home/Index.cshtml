@{
    ViewData["Title"] = "StormSafe - Weather Radar";
}

@section Styles {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
}

<div class="row">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Live Radar</h3>
            </div>
            <div class="card-body p-0">
                <div id="radar-container" style="height: 400px; background-color: #f8f9fa;">
                    <div id="map" style="height: 100%; width: 100%;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Storm Information</h3>
            </div>
            <div class="card-body">
                <div id="storm-info">
                    <div class="mb-3">
                        <h5>Storm Speed</h5>
                        <p id="storm-speed" class="h3">-- mph</p>
                    </div>
                    <div class="mb-3">
                        <h5>Direction</h5>
                        <p id="storm-direction" class="h3">--°</p>
                    </div>
                    <div class="mb-3">
                        <h5>Estimated Arrival</h5>
                        <p id="arrival-time" class="h3">--:--</p>
                    </div>
                    <div class="mb-3">
                        <h5>Distance</h5>
                        <p id="storm-distance" class="h3">-- miles</p>
                    </div>
                    <div class="mb-3">
                        <h5>Intensity</h5>
                        <div class="progress">
                            <div id="storm-intensity" class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        let map;
        let userMarker;

        function initMap() {
            // Create the map centered on a default location (can be updated with user's location)
            map = L.map('map').setView([39.8283, -98.5795], 4); // Center of USA

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Get user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map.setView([userLocation.lat, userLocation.lng], 8);
                        
                        // Add a marker for user's location
                        if (userMarker) {
                            map.removeLayer(userMarker);
                        }
                        userMarker = L.marker([userLocation.lat, userLocation.lng])
                            .addTo(map)
                            .bindPopup('Your Location')
                            .openPopup();
                    },
                    error => {
                        console.error('Error getting location:', error);
                    }
                );
            }
        }

        // Initialize the map when the page loads
        window.onload = initMap;
    </script>
}
